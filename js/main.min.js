function init(){const e=["spring","summer","fall","winter"],t=28,r=4*t,n=99999,a=[],o={day:1,season:"spring",year:1,timestamp:0},s={farmingLevel:0,profitType:"average",payForSeeds:!0,vendors:{generalStore:!0,jojaMart:!0,travelingCart:!1,oasis:!0,eggFestival:!0},fertilizer:0,greenhouse:!1},i={tiller:!1,agriculturist:!1},d=new Chart("chart",{type:"bar",data:{datasets:[{label:"Profit per Day"}]},options:{legend:{display:!1},scales:{yAxes:[{scaleLabel:{display:!0,labelString:"Gold"},ticks:{beginAtZero:!0}}],xAxes:[{ticks:{autoSkip:!1}}]}}});function l(e){return fetch(e).then(e=>{if(!e.ok){const t=new Error(`Failed to load resource '${e.url}'`);throw t.name=e.statusText,t.code=e.status,t}return e.json()})}function c(e,t=!0){const r=/\.[\d]{3,}/.test(e.toString())?e.toFixed(2):e;return t?`<span class="text-nowrap"><span class="icon gold"></span>${r}g</span>`:`${r}g`}function u(){const e=[];a.forEach(t=>{const n=JSON.parse(JSON.stringify(t));if(465===s.fertilizer||466===s.fertilizer||!0===i.agriculturist){let e=0;for(let r=0;r<t.phaseDays.length-1;r+=1)e+=t.phaseDays[r];let r=0;465===s.fertilizer?r=.1:466===s.fertilizer&&(r=.25),i.agriculturist&&(r+=.1);let a=Math.ceil(e*r);10!==e||.1!==r&&.2!==r||(a+=1);for(let e=0;a>0&&e<3;e+=1)for(let e=0;e<n.phaseDays.length&&((e>0||n.phaseDays[e]>1)&&(n.phaseDays[e]-=1,a-=1),!(a<=0));e+=1);}const a=o.timestamp%r,d=n.phaseDays.slice(0,t.phaseDays.length-1).reduce((e,t)=>e+t,0);if(!function(e,t,r){return r>=e.seasonStartDate&&r+t<e.seasonEndDate}(t,d,a)&&!s.greenhouse)return;if(t.seed.vendor.generalStore&&o.year<t.seed.vendor.generalStore.yearAvailable)return;if(400===t.indexOfHarvest&&o.timestamp<12&&!s.greenhouse)return;let l=function(e){let t=1/0;return Object.keys(e.vendor).forEach((r,n,a)=>{s.vendors[r]&&(1===a.length&&"travelingCart"===r?t=void 0!==e.vendor[r].price?e.vendor[r].price:e.vendor[r].avgPrice:e.vendor[r].price<t&&(t=e.vendor[r].price))}),t}(t.seed);if(s.payForSeeds&&l===1/0)return;s.payForSeeds?s.greenhouse&&t.daysToRegrow&&(l=0):l=0;let c=1,u=d;u=s.greenhouse?t.daysToRegrow?t.daysToRegrow:d:t.daysToRegrow?((c=Math.ceil((t.seasonEndDate-a-d)/t.daysToRegrow))-1)*t.daysToRegrow+d:(c=Math.floor((t.seasonEndDate-a-1)/d))*d;const g=function(e){let t=1;if(e.minHarvest>1||e.maxHarvest>1)if("minimum"===s.profitType)t=e.minHarvest;else{if("average"!==s.profitType)throw new Error(`options.profitType was '${s.profitType}', not 'minimum' or 'average', which is unexpected`);t=(e.minHarvest+(Math.min(e.minHarvest+1,e.maxHarvest+1+s.farmingLevel/e.maxHarvestIncreasePerFarmingLevel)-1))/2}return e.chanceForExtraCrops>0&&"minimum"!==s.profitType&&(t+=Math.min(.9,e.chanceForExtraCrops)),t}(t);let p=t.price,f=t.price;"average"===s.profitType&&(f=0,function(e,t=0){let r=0;368===t?r=1:369===t&&(r=2);const n=e/10*.2+.2*r*((e+2)/12)+.01;let a=Math.min(.75,2*n);return[1-n-(a*=1-n),a,n]}(s.farmingLevel,s.fertilizer).forEach((e,r)=>{f+=function(e,t){return Math.floor(e*(1+.25*t))}(t.price,r)*e})),i.tiller&&-1!==[-75,-79,-80].indexOf(t.category)&&("minimum"===s.profitType?(f=Math.floor(1.1*f),p=Math.floor(1.1*p)):(f*=1.1,p*=1.1));let m=0,h=m=1===t.harvestMethod?f*c*g:f*c*1+p*c*(g-1);s.payForSeeds&&(421===t.indexOfHarvest&&"average"===s.profitType?(s.greenhouse&&(l=0),h-=l):h-=l*(t.daysToRegrow?1:c));const y=h/u;s.greenhouse&&(c=1/0),n.avgProfit=y,n.daysToGrow=d,n.harvests=c,n.yield=g,n.adjustedSellPrice=f,n.seedPrice=l,n.profit=h,e.push(n)}),e.sort((e,t)=>e.name.localeCompare(t.name)),d.data.labels=e.map(e=>e.name),d.data.datasets[0].data=e.map(e=>e.avgProfit.toFixed(2)),d.data.datasets[0].backgroundColor=e.map(e=>`rgba(${e.color[0]}, ${e.color[1]}, ${e.color[2]}, 0.5)`),d.update();const t=document.getElementById("results").children[1];if(t.innerHTML="",!e.length){const e=document.createElement("tr");return e.classList.add("table-warning"),e.innerHTML='<td colspan="8">No crops can grow!</td>',void t.appendChild(e)}e.forEach(e=>{const r=document.createElement("tr");r.innerHTML=`<th scope="row" class="text-nowrap"><span class="icon crop" style="background-position: -${e.indexOfHarvest%24*16}px -${16*Math.floor(e.indexOfHarvest/24)}px;"></span>${e.name}</th>\n        <td>${c(e.avgProfit)}</td>\n        <td>${e.daysToGrow}</td>\n        <td>${e.harvests}</td>\n        <td>${e.yield}</td>\n        <td>${c(e.adjustedSellPrice)}</td>\n        <td>${c(e.seedPrice)}</td>\n        <td>${c(e.profit)}</td>`,t.appendChild(r)})}function g(t){const r=e.indexOf(t);if(r>=0)return r;throw new Error(`Failed to convert season '${t}' to integer`)}function p(n){const s=n.target,{id:i,value:d}=s;if("day"===i||"year"===i){if(!/^\d+$/.test(d))return;if(d<1)return;if("day"===i&&d>t)return;o[i]=Number(d)}else{if("season"!==i)throw new Error("Function dateChanged() was called in an invalid way; its only meant to be used as an event handler for the date inputs");if(-1===e.indexOf(d))return;o.season=d}o.timestamp=(o.year-1)*r+g(o.season)*t+(o.day-1),a.length&&u()}function f(e){s.payForSeeds=e.target.checked,s.payForSeeds?(document.getElementById("generalStore").disabled=!1,document.getElementById("jojaMart").disabled=!1,document.getElementById("oasis").disabled=!1,document.getElementById("travelingCart").disabled=!1):(document.getElementById("generalStore").disabled=!0,document.getElementById("jojaMart").disabled=!0,document.getElementById("oasis").disabled=!0,document.getElementById("travelingCart").disabled=!0),a.length&&u()}function m(e){const t=e.target,{id:r}=t;Object.prototype.hasOwnProperty.call(i,r)&&(i[r]=t.checked,a.length&&u())}function h(e){const t=e.target,{id:r}=t;Object.prototype.hasOwnProperty.call(s.vendors,r)&&(s.vendors[r]=t.checked,a.length&&u())}function y(e){const t=e.target,{value:r}=t;-1!==["minimum","average"].indexOf(r)&&(s.profitType=r,a.length&&u())}function v(e){const t=e.target,{value:r}=t;/^\d+$/.test(r)&&(Number(r)>10||(s.farmingLevel=Number(r),a.length&&u()))}function w(e){const t=e.target,{id:r}=t;-1!==["noFertilizer","basicFertilizer","qualityFertilizer","speedGro","deluxeSpeedGro"].indexOf(r)&&("noFertilizer"===r?s.fertilizer=0:"basicFertilizer"===r?s.fertilizer=368:"qualityFertilizer"===r?s.fertilizer=369:"speedGro"===r?s.fertilizer=465:"deluxeSpeedGro"===r&&(s.fertilizer=466),a.length&&u())}function b(e){const t=e.target,{id:r}=t;if("farm"===r)s.greenhouse=!1,document.getElementById("season").disabled=!1;else{if("greenhouse"!==r)return;s.greenhouse=!0,document.getElementById("season").disabled=!0}a.length&&u()}function E(e,t){e.forEach(e=>{const r=document.getElementById(e);let n="change";"input"===r.tagName.toLowerCase()&&"number"===r.type&&(n="input"),r.addEventListener(n,t)})}E(["day","season","year"],p),E(["payForSeeds"],f),E(["tiller","agriculturist"],m),E(["generalStore","jojaMart","oasis","travelingCart"],h),E(["profitType"],y),E(["farm","greenhouse"],b),E(["farmingLevel"],v),E(["noFertilizer","basicFertilizer","qualityFertilizer","speedGro","deluxeSpeedGro"],w),l("js/crops.json").then(function(e){l("js/colors.json").then(r=>{Object.values(e).forEach(e=>{const o=e;o.daysToRegrow=-1===e.regrowAfterHarvest?0:e.regrowAfterHarvest,o.phaseDays.push(n),o.color=r[e.indexOfHarvest],o.seasonStartDate=g(e.seasonsToGrowIn[0])*t,o.seasonEndDate=o.seasonStartDate+e.seasonsToGrowIn.length*t;const s=e.seed.vendor.travelingCart;s&&(o.seed.vendor.travelingCart.avgPrice=(s.minPrice+s.maxPrice)/2),a.push(o)}),u()})})}document.addEventListener("DOMContentLoaded",init);